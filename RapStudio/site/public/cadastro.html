<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro</title>
    <link rel="stylesheet" href="css/styleLogin-Cadastro.css">
    <link rel="website icon" type="png" href="assets/RapStudioLogo.png">
    <script src="https://kit.fontawesome.com/0d1baf2431.js" crossorigin="anonymous"></script>
</head>
<body>
    <div class="container">
        <div id="div_cadastro" class="box">
            <p class="titulo">Cadastro</p>
            <div class="inputs">
                <label>
                    <p>
                        Nome usuário:
                    </p>
                    <input type="text" id="inputNome" placeholder="User_Name">
                </label>
                <label>
                    <p>
                        E-mail:
                    </p>
                    <input type="email" id="inputEmail" placeholder="email@exemplo.com">
                </label>
                <label>
                    <p>
                        Senha:
                    </p>
                    <input type="password" id="inputSenha" placeholder="******************">
                </label>
            </div>
            <div class="centralizar">
                <button class="botaoAcao" onclick="alterarTela()">
                    Continuar
                </button>
                <a href="login.html">
                    <p>Entrar</p>
                </a>
                <a href="index.html">
                    <p>Voltar para a Home</p>
                </a>
            </div>
        </div>
    </div>


</body>
</html>
<script>
    var nomeVar
    var emailVar
    var senhaVar

    function alterarTela(){
        nomeVar = inputNome.value
        emailVar = inputEmail.value
        senhaVar = inputSenha.value

        div_cadastro.innerHTML = ` 
        <p class="titulo">Cadastrar</p>
            <div class="inputs">
                <label>
                    <p>
                        Data Nascimento
                    </p>
                    <input type="date" id="inputData">
                </label>
                <label>
                    <p>
                        UF:
                        <select id="selectEstado">
                            <option value="AC">Acre</option>
                            <option value="AL">Alagoas</option>
                            <option value="AP">Amapá</option>
                            <option value="AM">Amazonas</option>
                            <option value="BA">Bahia</option>
                            <option value="CE">Ceará</option>
                            <option value="DF">Distrito Federal</option>
                            <option value="ES">Espírito Santo</option>
                            <option value="GO">Goiás</option>
                            <option value="MA">Maranhão</option>
                            <option value="MT">Mato Grosso</option>
                            <option value="MS">Mato Grosso do Sul</option>
                            <option value="MG">Minas Gerais</option>
                            <option value="PA">Pará</option>
                            <option value="PB">Paraíba</option>
                            <option value="PR">Paraná</option>
                            <option value="PE">Pernambuco</option>
                            <option value="PI">Piauí</option>
                            <option value="RJ">Rio de Janeiro</option>
                            <option value="RN">Rio Grande do Norte</option>
                            <option value="RS">Rio Grande do Sul</option>
                            <option value="RO">Rondônia</option>
                            <option value="RR">Roraima</option>
                            <option value="SC">Santa Catarina</option>
                            <option value="SP">São Paulo</option>
                            <option value="SE">Sergipe</option>
                            <option value="TO">Tocantins</option>
                        </select>
                    </p>
                </label>
                <label>
                    <p>
                        Cidade:
                    </p>
                    <input type="text" id="inputCidade" placeholder="Ex: Osasco">
                </label>
            </div>
            <div class="centralizar">
                <button class="botaoAcao" onclick="cadastrar()">
                    Cadastrar-se
                </button>
                <a href="login.html">
                    <p>Entrar</p>
                </a>
                <a href="index.html">
                    <p>Voltar para a Home</p>
                </a>
            </div>`

    }
    function cadastrar() {
    // aguardar();

    //Recupere o valor da nova input pelo nome do id
    // Agora vá para o método fetch logo abaixo
    var estadoVar = selectEstado.value;
    var dataNascVar = inputData.value;
    var cidadeVar = inputCidade.value
    if (
      nomeVar == "" ||
      emailVar == "" ||
      senhaVar == "" ||
      estadoVar == "" ||
      cidadeVar == "" ||
      dataNascVar == ""
    ) {
      cardErro.style.display = "block";
      mensagem_erro.innerHTML =
        "(Mensagem de erro para todos os campos em branco)";

      finalizarAguardar();
      return false;
    } else {
    //    setInterval(sumirMensagem, 5000);
    }

    // Enviando o valor da nova input
    fetch("/usuarios/cadastrar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/usuario.js
        nomeServer: nomeVar,
        emailServer: emailVar,
        senhaServer: senhaVar,
        estadoServer: estadoVar,
        cidadeServer: cidadeVar, 
        dataNascServer: dataNascVar 
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
        //   cardErro.style.display = "block";

        //   mensagem_erro.innerHTML =
        //     "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

          setTimeout(() => {
            window.location = "login.html";
          }, "2000");

        //   limparFormulario();
        //   finalizarAguardar();
        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        // finalizarAguardar();
      });

    return false;
  }

//   function listar() {
//     fetch("/empresas/listar", {
//       method: "GET",
//     })
//       .then(function (resposta) {
//         resposta.json().then((empresas) => {
//           empresas.forEach((empresa) => {
//             listaEmpresas.innerHTML += `<option value='${empresa.id}'>${empresa.cnpj}</option>`;
//           });
//         });
//       })
//       .catch(function (resposta) {
//         console.log(`#ERRO: ${resposta}`);
//       });
//   }

//   function sumirMensagem() {
//     cardErro.style.display = "none";
//   }

</script>